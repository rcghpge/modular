load("//bazel:api.bzl", "modular_py_test", "mojo_shared_library")

package(default_visibility = ["//visibility:private"])

# Test to establish the behavior of what happens if you have a .mojo and .so file with the same name in the same directory.
# The current behavior is that the .mojo file is used as the source for the shared library, and the .so file is ignored.
# This test ensures that this behavior continues to work as expected.

mojo_shared_library(
    name = "module1",
    # This is intentional
    srcs = ["module2.mojo"],
    shared_lib_name = "module1.so",
    target_compatible_with = select({
        "//:asan": ["@platforms//:incompatible"],
        "//:tsan": ["@platforms//:incompatible"],
        "//:ubsan": ["@platforms//:incompatible"],
        "//conditions:default": [],
    }),
    deps = [
        "@mojo//:std",
    ],
)

modular_py_test(
    name = "main",
    srcs = ["test_module.py"],
    data = [
        ":module1",
        ":module1.mojo",
    ],
    imports = ["."],
    deps = [
        "@mojo//:python",
    ],
)
