commit 4bbc26b1a4566ccbd41ec2dd8ec75cfabaa7793c
Author:     Michael Allwright <contact@allwright.io>
AuthorDate: Tue Apr 29 21:31:21 2025 +0200
Commit:     Keith Smiley <keithbsmiley@gmail.com>
CommitDate: Wed Sep 3 16:59:34 2025 -0700

    Absolutize paths beginning with `bazel-out/` (#1392)

diff --git a/foreign_cc/private/cc_toolchain_util.bzl b/foreign_cc/private/cc_toolchain_util.bzl
index f0cef2e..6613448 100644
--- a/foreign_cc/private/cc_toolchain_util.bzl
+++ b/foreign_cc/private/cc_toolchain_util.bzl
@@ -352,9 +352,10 @@ def _add_if_needed(arr, add_arr):
 def absolutize_path_in_str(workspace_name, root_str, text, force = False):
     """Replaces relative paths in [the middle of] 'text', prepending them with 'root_str'. If there is nothing to replace, returns the 'text'.

-    We only will replace relative paths starting with either 'external/' or '<top-package-name>/',
-    because we only want to point with absolute paths to external repositories or inside our
-    current workspace. (And also to limit the possibility of error with such not exact replacing.)
+    We only will replace relative paths starting with either 'external/', 'bazel-out/', or
+    '<top-package-name>/', because we only want to point with absolute paths to external
+    repositories or inside our current workspace. (And also to limit the possibility of error with
+    such not exact replacing.)

     Args:
         workspace_name: workspace name
@@ -367,7 +368,9 @@ def absolutize_path_in_str(workspace_name, root_str, text, force = False):
     """
     new_text = _prefix(text, "external/", root_str)
     if new_text == text:
-        new_text = _prefix(text, workspace_name + "/", root_str)
+        new_text = _prefix(text, "bazel/", root_str)
+        if new_text == text:
+            new_text = _prefix(text, workspace_name + "/", root_str)

     # Check to see if the text is already absolute on a unix and windows system
     is_already_absolute = text.startswith("/") or \
