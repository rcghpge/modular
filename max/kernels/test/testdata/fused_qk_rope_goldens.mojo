# ===----------------------------------------------------------------------=== #
# Copyright (c) 2025, Modular Inc. All rights reserved.
#
# Licensed under the Apache License v2.0 with LLVM Exceptions:
# https://llvm.org/LICENSE.txt
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ===----------------------------------------------------------------------=== #


# The following inputs and golden values were generated using the upstream code
# [here](https://github.com/meta-llama/llama/blob/8fac8befd776bc03242fe7bc2236cdb41b6c609c/llama/model.py).
def k_cache_input[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            -2.5095443725585938, 0.4880010485649109, 0.7845868468284607, 0.02864718623459339, 0.640755295753479, 0.5832474231719971, 1.0669267177581787, -0.4501533806324005,
            -0.18526747822761536, 0.7527588605880737, 0.4047577977180481, 0.17846599221229553, 0.2649095058441162, 1.2731683254241943, -0.0013108636485412717, -0.30360376834869385,
            -1.457029104232788, -0.10233523696660995, -0.5991530418395996, 0.4770564138889313, 0.7261772155761719, 0.09115186333656311, -0.3890652060508728, 0.5279164910316467,
            -0.012685478664934635, 0.24083632230758667, 0.13253536820411682, 0.7642406225204468, 1.095009684562683, 0.3398909568786621, 0.7199674844741821, 0.41140761971473694,
            1.931160569190979, 1.0118638277053833, -1.4364064931869507, -1.1298598051071167, -0.1360345333814621, 1.6354095935821533, 0.6547407507896423, 0.5760045647621155,
            1.1415079832077026, 0.018564576283097267, -1.8058050870895386, 0.9254348874092102, -0.3753443658351898, 1.0330873727798462, -0.6866509318351746, 0.6368136405944824,
            -0.9726738929748535, 0.9584577679634094, 1.6192004680633545, 1.450609803199768, 0.2694815397262573, -0.21037597954273224, -0.7328027486801147, 0.10429783165454865,
            0.3487516939640045, 0.9675941467285156, -0.46568843722343445, 1.6047972440719604, -2.4801201820373535, -0.4175437390804291, -1.1954537630081177, 0.8123369216918945,
            -1.9005532264709473, 0.22857652604579926, 0.02485940419137478, -0.34595024585723877, 0.2868328094482422, -0.7308424115180969, 0.17482025921344757, -1.0939292907714844,
            -1.6021603345870972, 1.3528969287872314, 1.288827657699585, 0.05229547247290611, -1.5468504428863525, 0.7567060589790344, 0.7755194902420044, 2.0265355110168457,
            0.03581761196255684, 0.12058872729539871, -0.8056637048721313, -0.20757682621479034, -0.9319478273391724, -1.5909662246704102, -1.13597571849823, -0.52259761095047,
            -0.5187733173370361, -1.5012763738632202, -1.9266542196273804, 0.1278512328863144, 1.0229133367538452, -0.5557951331138611, 0.7042727470397949, 0.7098760008811951,
            # fmt: on
        )
    )


def q_input[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            1.9269152879714966, 1.4872840642929077, 0.9007171988487244, -2.1055209636688232, 0.6784184575080872, -1.2345448732376099, -0.04306747764348984, -1.6046669483184814,
            -0.7521352767944336, 1.6487230062484741, -0.3924786448478699, -1.4036071300506592, -0.7278813123703003, -0.5594301819801331, -0.7688388824462891, 0.7624453902244568,
            1.6423169374465942, -0.1595974713563919, -0.4973975419998169, 0.439589262008667, -0.7581311464309692, 1.078317642211914, 0.8008005619049072, 1.680620551109314,
            1.27912437915802, 1.2964228391647339, 0.610466480255127, 1.334737777709961, -0.2316243201494217, 0.041759490966796875, -0.2515752911567688, 0.859858512878418,
            -1.3846737146377563, -0.8712361454963684, -0.223365917801857, 1.7173614501953125, 0.3188803195953369, -0.42451897263526917, 0.3057209253311157, -0.7745925188064575,
            -1.5575724840164185, 0.9956361055374146, -0.8797858357429504, -0.6011420488357544, -1.2741512060165405, 2.1227850914001465, -1.234653115272522, -0.4879138767719269,
            -0.9138230085372925, -0.6581372618675232, 0.07802387326955795, 0.5258087515830994, -0.48799172043800354, 1.1913690567016602, -0.8140076398849487, -0.7359927892684937,
            -1.4032478332519531, 0.03600366786122322, -0.06347727030515671, 0.6756148934364319, -0.0978068932890892, 1.8445940017700195, -1.184537410736084, 1.3835493326187134,
            1.4451338052749634, 0.8564125299453735, 2.218075752258301, 0.5231655240058899, 0.34664666652679443, -0.19733144342899323, -1.0545889139175415, 1.2779955863952637,
            -0.1721901297569275, 0.5237884521484375, 0.056621819734573364, 0.4262961447238922, 0.575005054473877, -0.6417241096496582, -2.2063984870910645, -0.7508030533790588,
            0.01086814422160387, -0.33874234557151794, -1.3406795263290405, -0.5853705406188965, 0.5361881256103516, 0.5246226191520691, 1.1412016153335571, 0.05164359509944916,
            0.7439519762992859, -0.4815843999385834, -1.0494661331176758, 0.603898823261261, -1.7222950458526611, -0.827768862247467, 1.334702968597412, 0.48353928327560425,
            # fmt: on
        )
    )


def freqs_cis_table_input[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0,
            0.5403022766113281, 0.8414709568023682, 0.9129061102867126, 0.4081696569919586, 0.9844156503677368, 0.17585742473602295, 0.9972391128540039, 0.074257031083107,
            -0.416146844625473, 0.9092974066734314, 0.666795015335083, 0.7452411651611328, 0.9381483197212219, 0.3462335765361786, 0.9889717698097229, 0.14810402691364288,
            -0.9899924993515015, 0.14112000167369843, 0.304536372423172, 0.9525007009506226, 0.8626401424407959, 0.5058180689811707, 0.9752436280250549, 0.2211332470178604,
            -0.6536436080932617, -0.756802499294281, -0.11076875030994415, 0.9938461780548096, 0.760244607925415, 0.6496369242668152, 0.9561303853988647, 0.2929414212703705,
            0.28366219997406006, -0.9589242935180664, -0.5067793130874634, 0.8620758056640625, 0.6341531872749329, 0.773207426071167, 0.9317376613616943, 0.3631320595741272,
            0.9601702690124512, -0.279415488243103, -0.8145151734352112, 0.5801422595977783, 0.48829612135887146, 0.8726779818534851, 0.9022001624107361, 0.4313175678253174,
            0.7539022564888, 0.6569865942001343, -0.9803723096847534, 0.19715513288974762, 0.3272193670272827, 0.9449484348297119, 0.8676809668540955, 0.4971214532852173,
            -0.1455000340938568, 0.9893582463264465, -0.9754605889320374, -0.22017420828342438, 0.15594372153282166, 0.9877659678459167, 0.8283706307411194, 0.5601803660392761,
            -0.9111302495002747, 0.41211849451065063, -0.8006353974342346, -0.5991518497467041, -0.02019248716533184, 0.9997960925102234, 0.7844862937927246, 0.6201461553573608,
            -0.83907151222229, -0.5440211296081543, -0.4863494336605072, -0.8737643957138062, -0.19569943845272064, 0.9806638956069946, 0.7362702488899231, 0.6766875982284546,
            0.004425697959959507, -0.9999902248382568, -0.08734714239835739, -0.9961779117584229, -0.36510658264160156, 0.9309657216072083, 0.6839886903762817, 0.7294926047325134,
            0.8438539505004883, -0.5365729331970215, 0.3268699645996094, -0.9450693130493164, -0.5231338143348694, 0.8522505760192871, 0.6279303431510925, 0.7782695889472961,
            0.9074468016624451, 0.4201670289039612, 0.6841502785682678, -0.7293410897254944, -0.6648556590080261, 0.746971845626831, 0.5684047341346741, 0.8227490782737732,
            0.13673721253871918, 0.9906073808670044, 0.9222596883773804, -0.38657087087631226, -0.7858549952507019, 0.6184108257293701, 0.5057405233383179, 0.8626856207847595,
            -0.7596879005432129, 0.6502878665924072, 0.9997230172157288, 0.02353563718497753, -0.88236004114151, 0.47057491540908813, 0.44028377532958984, 0.8978586792945862,
            -0.9576594829559326, -0.2879033088684082, 0.9030466079711914, 0.42954251170158386, -0.9513630867004395, 0.3080717921257019, 0.3723958730697632, 0.9280740022659302,
            -0.27516335248947144, -0.9613974690437317, 0.6490705013275146, 0.7607282996177673, -0.9907134175300598, 0.1359664797782898, 0.3024517297744751, 0.9531646966934204,
            0.6603167057037354, -0.7509872317314148, 0.28203409910202026, 0.9594044089317322, -0.9991845488548279, -0.04037673771381378, 0.23083752393722534, 0.9729923009872437,
            0.9887046217918396, 0.14987720549106598, -0.13412874937057495, 0.9909639358520508, -0.9765123128890991, -0.21546170115470886, 0.15794868767261505, 0.9874473214149475,
            0.4080820679664612, 0.9129452705383301, -0.5269284248352051, 0.8499096632003784, -0.9234034419059753, -0.3838307559490204, 0.08418771624565125, 0.996449887752533,
            -0.5477292537689209, 0.8366556167602539, -0.8279435634613037, 0.5608114004135132, -0.8415133357048035, -0.5402362942695618, 0.009961873292922974, 0.9999504089355469,
            -0.9999608397483826, -0.008851309306919575, -0.9847409725189209, 0.17402659356594086, -0.7333943843841553, -0.6798034310340881, -0.06431897729635239, 0.9979293942451477,
            -0.5328330397605896, -0.8462204337120056, -0.970008373260498, -0.2430715411901474, -0.6024162769317627, -0.7981820702552795, -0.13824467360973358, 0.990398108959198,
            0.4241790175437927, -0.9055783748626709, -0.7863120436668396, -0.6178295612335205, -0.45266202092170715, -0.8916821479797363, -0.21140702068805695, 0.9773980975151062,
            0.9912028312683105, -0.13235175609588623, -0.46564969420433044, -0.8849691152572632, -0.2887984812259674, -0.9573898911476135, -0.2834020256996155, 0.9590011835098267,
            0.646919310092926, 0.7625584602355957, -0.06387679278850555, -0.9979577660560608, -0.11593390256166458, -0.9932569265365601, -0.3538321852684021, 0.9353089332580566,
            -0.29213881492614746, 0.9563759565353394, 0.3490217924118042, -0.9371145963668823, 0.06054464727640152, -0.998165488243103, -0.42230844497680664, 0.9064521789550781,
            -0.962605893611908, 0.2709057927131653, 0.7011259198188782, -0.7130374908447266, 0.23513609170913696, -0.9719624519348145, -0.48845306038856506, 0.872590184211731,
            -0.7480575442314148, -0.6636338829994202, 0.931102454662323, -0.36475780606269836, 0.4023981988430023, -0.9154647588729858, -0.5519005656242371, 0.8339099287986755,
            0.15425145626068115, -0.9880316257476807, 0.9988921284675598, 0.047058235853910446, 0.5571185350418091, -0.8304330110549927, -0.6123003959655762, 0.7906252145767212,
            0.9147423505783081, -0.4040376543998718, 0.8926869630813599, 0.4506773054599762, 0.6944738030433655, -0.7195180058479309, -0.6693193316459656, 0.7429748773574829,
            # fmt: on
        )
    )


def q_out_golden[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            1.9269152879714966, 1.4872840642929077, 0.9007171988487244, -2.1055209636688232, 0.6784184575080872, -1.2345448732376099, -0.04306747764348984, -1.6046669483184814,
            -0.7521352767944336, 1.6487230062484741, -0.3924786448478699, -1.4036071300506592, -0.7278813123703003, -0.5594301819801331, -0.7688388824462891, 0.7624453902244568,
            1.0216442346572876, 1.2957311868667603, -0.6335042715072632, 0.19828112423419952, -0.9359463453292847, 0.9281896948814392, 0.673791766166687, 1.7354456186294556,
            -0.39978840947151184, 1.7768062353134155, 0.012499133124947548, 1.467664122581482, -0.235358327627182, 0.00037584119127132, -0.31473127007484436, 0.8388032913208008,
            1.3684403896331787, -0.8965180516242981, -1.4287877082824707, 0.9786665439605713, 0.44613975286483765, -0.2878546714782715, 0.4170696437358856, -0.7207716703414917,
            -0.25715047121047974, -1.83062744140625, -0.13864099979400635, -1.0564911365509033, -1.930322289466858, 1.5503333806991577, -1.1487751007080078, -0.665390133857727,
            -0.8903208374977112, 0.6895984411239624, -0.4928278923034668, -0.19920650124549866, -1.2306369543075562, 0.37819167971611023, -0.4911789894104004, -0.98134446144104,
            -0.36352357268333435, 1.3558213710784912, -0.5502622723579407, -0.39710986614227295, -1.4882783889770508, 1.0941301584243774, -1.6060892343521118, 0.8589615225791931,
            1.6268694400787354, 0.4185090959072113, -2.1101667881011963, 0.860673189163208, 0.3414730131626129, 0.2061547338962555, -1.5026723146438599, 0.6981451511383057,
            -0.018977241590619087, 0.5510386824607849, -0.29343172907829285, -0.31437596678733826, 0.8407912254333496, 0.18844285607337952, -1.666778564453125, -1.629033088684082,
            0.2307427078485489, -0.24823838472366333, 1.4297739267349243, 0.3095592260360718, -0.320290207862854, 0.6783367991447449, 0.9645257592201233, 0.6121259927749634,
            0.8772615790367126, 0.12569890916347504, 0.9098057746887207, -0.7989532947540283, 0.2186306118965149, -1.8983420133590698, 0.9177185893058777, 1.0830672979354858,
            # fmt: on
        )
    )


def k_out_golden[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            -2.5095443725585938, 0.4880010485649109, 0.7845868468284607, 0.02864718623459339, 0.640755295753479, 0.5832474231719971, 1.0669267177581787, -0.4501533806324005,
            -0.18526747822761536, 0.7527588605880737, 0.4047577977180481, 0.17846599221229553, 0.2649095058441162, 1.2731683254241943, -0.0013108636485412717, -0.30360376834869385,
            -0.7011240124702454, -1.2813396453857422, -0.741690456867218, 0.1909516304731369, 0.6988304853439331, 0.21743497252464294, -0.4271925389766693, 0.49756816029548645,
            -0.20951077342033386, 0.11944995820522308, -0.190947487950325, 0.7517768740653992, 1.018172264099121, 0.527159571647644, 0.6874298453330994, 0.4637344181537628,
            -1.723731517791748, 1.3349153995513916, -0.11577068269252777, -1.8238540887832642, -0.6938542723655701, 1.4871571063995361, 0.5622115135192871, 0.6666219830513,
            -0.49191567301750183, 1.0302447080612183, -1.8937740325927734, -0.7286849021911621, -0.7098182439804077, 0.839232325553894, -0.7733930349349976, 0.5280949473381042,
            0.6431776285171509, 1.2045989036560059, -2.071112871170044, 0.6607345342636108, 0.3335568308830261, 0.07495452463626862, -0.7206538319587708, -0.1689259558916092,
            1.0267771482467651, -0.059956587851047516, -1.1474555730819702, -1.2147367000579834, -1.2499282360076904, -2.18243408203125, -1.4088349342346191, 0.32277733087539673,
            -1.7609869241714478, 0.750516414642334, 0.18045198917388916, 0.29620373249053955, 0.7778494358062744, -0.10655484348535538, 0.6295537948608398, -0.911540150642395,
            -1.160326361656189, 1.7466797828674316, -1.0801085233688354, 0.7051079273223877, -1.4156817197799683, -0.9804056882858276, -0.17440654337406158, 2.1628358364105225,
            -0.05222219601273537, 0.11444380134344101, 0.8307752013206482, 0.044661831110715866, 1.1984295845031738, -1.4012376070022583, -0.7258700132369995, -1.018165946006775,
            0.5952140688896179, -1.4726427793502808, 1.8636319637298584, -0.5051915645599365, 0.8599147796630859, 0.7847334146499634, 0.25818946957588196, 0.9660549759864807,
            # fmt: on
        )
    )


# Data generated with custom position ids
def position_ids_input[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[UInt32](
            # fmt: off
            2, 4, 5,  # Batch 0's position ids
            6, 3, 1,
            # Batch 1's position ids
            # fmt: on
        )
    )


def q_out_golden_with_position_ids[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            -2.1542632579803467, 1.13321053981781, 2.1697146892547607, -0.7326993942260742, 1.063897967338562, -0.9232949614524841, 0.19506511092185974, -1.593348741531372,
            -1.186180830001831, -1.3700255155563354, 0.7843230962753296, -1.2284094095230103, -0.48916712403297424, -0.7768454551696777, -0.8732811808586121, 0.6401688456535339,
            -1.1942737102508545, -1.1385897397994995, -0.3817880153656006, -0.5430294275283813, -1.276880145072937, 0.32727518677711487, 0.2733463943004608, 1.841480016708374,
            0.14504455029964447, -1.8154430389404297, -1.3941446542739868, 0.4588625431060791, -0.20321965217590332, -0.1187242865562439, -0.49242696166038513, 0.7484400272369385,
            -1.2282291650772095, 1.0806604623794556, -1.3672986030578613, -1.062881588935852, 0.5304601788520813, -0.022649439051747322, 0.566131055355072, -0.6106999516487122,
            0.5129151940345764, 1.7760183811187744, 0.9640873074531555, -0.45379573106765747, -2.4493603706359863, 0.36098772287368774, -0.9731956124305725, -0.902949869632721,
            -1.0613194704055786, -0.37658753991127014, -0.36859551072120667, -0.3830142617225647, -1.277966022491455, 0.15588128566741943, -0.4169512093067169, -1.015108585357666,
            -1.3372968435287476, 0.42665883898735046, -0.34024953842163086, -0.5871244072914124, -1.6574952602386475, 0.8153541684150696, -1.6654390096664429, 0.7373266220092773,
            -1.5515285730361938, -0.6439046859741211, 0.17716920375823975, 2.2720415592193604, 0.3988451361656189, 0.005114125087857246, -1.3110884428024292, 1.0131523609161377,
            0.09654991328716278, -0.5428460836410522, -0.38880395889282227, 0.18375501036643982, 0.8206180930137634, -0.26272904872894287, -1.985748529434204, -1.2201238870620728,
            0.2909139096736908, -0.1738780289888382, -0.9849840402603149, -1.0816130638122559, 0.43557319045066833, 0.6107393503189087, 1.1342159509658813, 0.13624325394630432,
            0.8071982264518738, 0.36581283807754517, -1.204557180404663, 0.12294267863035202, -1.5498849153518677, -1.1177469491958618, 1.2951117753982544, 0.5813153386116028
            # fmt: on
        )
    )


def k_out_golden_with_position_ids[dtype: DType]() -> List[Scalar[dtype]]:
    return rebind[List[Scalar[dtype]]](
        List[Float32](
            # fmt: off
            0.6006008982658386, -2.485002279281616, 0.5018095374107361, 0.6038082242012024, 0.3991836607456207, 0.769023597240448, 1.1218299865722656, -0.2871728539466858,
            -0.6073831915855408, -0.4817214608192444, 0.13689027726650238, 0.4206424057483673, -0.19228921830654144, 1.286141276359558, 0.04366853088140488, -0.3004496991634369,
            0.874930202960968, 1.1695740222930908, -0.40775325894355774, -0.6483088731765747, 0.4928566813468933, 0.5410492420196533, -0.5266456604003906, 0.3907836675643921,
            0.1905573159456253, -0.14782072603702545, -0.7742184400558472, 0.04706578701734543, 0.6116694808006287, 0.9697589874267578, 0.5678644776344299, 0.6042676568031311,
            1.518097996711731, -1.5648093223571777, 1.7019659280776978, -0.665701687335968, -1.3507776260375977, 0.9319173097610474, 0.4008809030056, 0.7744425535202026,
            0.34160467982292175, -1.0893536806106567, 0.11734966188669205, -2.0257320404052734, -1.0368165969848633, 0.36491659283638, -0.8710259795188904, 0.3439982831478119,
            -0.6661246418952942, 1.1920628547668457, -2.160423517227173, -0.2421770840883255, 0.3151772916316986, 0.132444828748703, -0.7061202526092529, -0.22197318077087402,
            0.6052218079566956, 0.8316085338592529, -0.5517004132270813, -1.5772972106933594, -0.8466518521308899, -2.3682312965393066, -1.4289137125015259, 0.21727026998996735,
            1.8492766618728638, -0.49449512362480164, 0.3370884358882904, -0.08167583495378494, 0.6171067953109741, -0.4853687882423401, 0.41239649057388306, -1.028188943862915,
            1.3952058553695679, -1.5654547214508057, 0.34268343448638916, 1.2435351610183716, -1.7171308994293213, -0.12965986132621765, 0.30818605422973633, 2.1478588581085205,
            -0.08211956918239594, 0.09529384970664978, -0.6507687568664551, -0.5183456540107727, -0.6376408338546753, -1.7300620079040527, -1.094032883644104, -0.6055089235305786,
            0.9829860925674438, -1.2476757764816284, -1.8110394477844238, -0.6696856021881104, 1.1047126054763794, -0.36724653840065, 0.6496150493621826, 0.760213315486908
            # fmt: on
        )
    )
