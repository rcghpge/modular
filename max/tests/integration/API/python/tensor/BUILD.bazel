load("//bazel:api.bzl", "modular_py_test")

[
    modular_py_test(
        # Maintaining test names, see GEX-2687
        name = file[:-3],
        size = "large",
        srcs = [
            file,
            "conftest.py",
        ],
        # FIXME: GEX-2687
        tags = ["manual"] if file == "test_tensor.py" else [],
        target_compatible_with = select({
            "//:apple_gpu": ["@platforms//:incompatible"],
            "//conditions:default": [],
        }),  # FIXME: MOCO-2411
        deps = [
            "//SDK/lib/API/python/max/experimental",
            "//SDK/lib/API/python/max/nn",
        ],
    )
    for file in glob(
        ["*.py"],
        exclude = ["conftest.py"],
    )
]
