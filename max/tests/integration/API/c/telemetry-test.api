// REQUIRES: GENERATED_ONNX_TESTS
// UNSUPPORTED: Windows
// RUN: mkdir -p %t

// COM: Successful execution.
// RUN: rm -f %t/max-engine-telemetry-test-telemetry-success-logs
// RUN: rm -f %t/max-engine-telemetry-metrics
// RUN: MODULAR_TELEMETRY_EXPORTERS_METRICS_FILE_PATH=%t/max-engine-telemetry-metrics MODULAR_TELEMETRY_EXPORTERS_LOGS_FILE_PATH=%t/max-engine-telemetry-test-telemetry-success-logs modular-api-executor --model-inputs=zeros  --num-threads=0 --result-output-style=full %onnx_test_models_dir/test_abs/model.onnx
// RUN: cat %t/max-engine-telemetry-test-telemetry-success-logs | FileCheck %s --check-prefix=CHECK-SUCCESS

// COM: Error condition.
// RUN: rm -f %t/max-engine-telemetry-test-telemetry-error-logs
// RUN: MODULAR_TELEMETRY_EXPORTERS_LOGS_FILE_PATH=%t/max-engine-telemetry-test-telemetry-error-logs not modular-api-executor --model-inputs=zeros  --num-threads=0 --result-output-style=full non-existent.onnx
// RUN: cat %t/max-engine-telemetry-test-telemetry-error-logs | FileCheck %s --check-prefix=CHECK-ERROR

// COM: API Source Recorded.
// RUN: rm -f %t/max-engine-telemetry-test-telemetry-error-logs
// RUN: MODULAR_TELEMETRY_EXPORTERS_LOGS_FILE_PATH=%t/max-engine-telemetry-test-telemetry-error-logs modular-api-executor --model-inputs=zeros  --num-threads=0 --result-output-style=full %onnx_test_models_dir/test_abs/model.onnx
// RUN: cat %t/max-engine-telemetry-test-telemetry-error-logs | FileCheck %s --check-prefix=CHECK-API-LANGUAGE

// RUN: cat %t/max-engine-telemetry-metrics | FileCheck %s --check-prefix=CHECK-METRICS

// CHECK-SUCCESS: compile.success
// CHECK-SUCCESS-NOT: compile.failure

// CHECK-ERROR: compile.failure
// CHECK-ERROR: invalid path
// CHECK-ERROR-NOT: compile.success

// CHECK-API-LANGUAGE: max.engine.api.language: c

// CHECK-METRICS-DAG: engine.load_model
// CHECK-METRICS-DAG: value{{.*}}: 1
// CHECK-METRICS-DAG: framework: ONNX
