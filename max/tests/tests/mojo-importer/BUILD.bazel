load("//bazel:api.bzl", "modular_py_test")

modular_py_test(
    name = "mojo-importer",
    srcs = glob(["*.py"]),
    data = glob(["*.mojo"]) + ["//KGEN/tools/mojo"],
    env = {
        "PATH": "KGEN/tools/mojo:/usr/bin:/bin",
        # HACK: This test invokes "mojo build" in a subprocess, but it can't
        # see modular.cfg, so we need to provide the run path here to
        # find CompilerRT.
        "MODULAR_MOJO_MAX_SHARED_LIBS": "-Xlinker,-rpath,-Xlinker,KGEN",
    },
    mojo_deps = [
        "//open-source/mojo/stdlib/stdlib",
    ],
    target_compatible_with = select({
        "//:asan": ["@platforms//:incompatible"],
        "//:tsan": ["@platforms//:incompatible"],
        "//:ubsan": ["@platforms//:incompatible"],
        "//conditions:default": [],
    }),
    deps = [
        "//SDK/lib/API/python/max/_mojo",
    ],
)
