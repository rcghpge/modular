load("//bazel:api.bzl", "modular_py_test", "requirement")

package(default_visibility = [
    "//:__pkg__",
    "//SDK/integration-test:__subpackages__",
    "//max/tests:__subpackages__",
    "//oss/modular/max/tests:__subpackages__",
])

[
    modular_py_test(
        name = src.split("/")[-1].split(".")[0],
        srcs = [
            "conftest.py",
            src,
        ],
        gpu_constraints = ["//:has_gpu"] + select({
            "//:apple_gpu": ["@platforms//:incompatible"],
            "//conditions:default": [],
        }),  # FIXME: MOCO-2411
        imports = ["."],
        tags = [
            "gpu",
            "no-pydeps",  # Declaring tests in a loop like this doesn't work well with pydeps
        ],
        deps = [
            "//max/python/max/engine",
            "//max/python/max/graph",
            "//max/python/max/support",
            requirement("numpy"),
        ],
    )
    for src in glob(["test_*.py"])
]
